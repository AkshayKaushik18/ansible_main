#!/bin/bash


result=$(curl -X GET --header "Accept: */*" "https://api.github.com/repos/Sunbird-cQube/grammar-ms/releases/latest")
echo "******************************************************* Response from server ********************************************************"
key='zipball_url'
value=$(echo $result | jq -r ".$key")
echo "$result"
echo "$value"
rm -rf cqube-ingest.zip
rm -rf Sunbird-cQube*
echo "***************************************************** Downloading the zip file ******************************************************"
wget -O cqube-ingest.zip $value
echo "****************************************************** Unzipping the zip file *******************************************************"
unzip cqube-ingest.zip
cd Sunbird-cQube-grammar-ms-178386a/c-qube
echo "***************************************************** Adding Database_url to the .env file ******************************************"
touch .env
echo "DATABASE_URL=postgres://cqube_user:cQube@123@postgres_app:5432/cqube"> .env
echo "***************************************************** Installing the yarn ***********************************************************"
yarn install

npx prisma generate
npx prisma migrate deploy
